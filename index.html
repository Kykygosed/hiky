<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Connexion — KykyProject</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6d28d9">
  <style>
    :root{
      --purple:#6d28d9;
      --purple-600:#7c3aed;
      --bg1: linear-gradient(135deg,#f5f3ff 0%, #fef3c7 100%);
      --card-bg: rgba(255,255,255,0.9);
      --glass: rgba(255,255,255,0.55);
      --muted:#6b7280;
      --danger:#ef4444;
      --success:#10b981;
    }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial; margin:0;padding:0}
    html,body{height:100%}
    body{
      min-height:100vh;
      background: var(--bg1);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px;
    }

    /* Card */
    .wrap{
      width:100%;
      max-width:980px;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:28px;
      align-items:center;
    }

    .hero{
      border-radius:20px;
      background:
        radial-gradient(600px 200px at 10% 10%, rgba(124,58,237,0.08), transparent 8%),
        linear-gradient(180deg, rgba(124,58,237,0.06), transparent 40%),
        var(--card-bg);
      padding:36px;
      box-shadow: 0 10px 30px rgba(16,24,40,0.08);
      min-height:420px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:18px;
    }

    .brand{
      display:flex;gap:12px;align-items:center;
    }
    .logo{
      width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--purple),var(--purple-600));
      display:grid;place-items:center;color:white;font-weight:700; font-size:20px; box-shadow:0 6px 18px rgba(99,102,241,0.18);
    }
    h1{font-size:28px;color:#0f172a}
    p.lead{color:var(--muted);max-width:46ch}

    /* Right: form card */
    .card{
      border-radius:16px;
      padding:20px;
      background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));
      box-shadow: 0 10px 30px rgba(2,6,23,0.08);
    }

    .form-title{font-weight:700;font-size:20px;color:#0f172a;margin-bottom:6px}
    .form-sub{font-size:13px;color:var(--muted);margin-bottom:12px}

    form {display:flex;flex-direction:column;gap:12px}
    label{font-size:13px;color:#111827}
    input[type="email"], input[type="password"]{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid #e6e9ef;
      background:white;
      outline:none;
      font-size:14px;
    }
    input:focus{box-shadow:0 4px 14px rgba(99,102,241,0.08);border-color:var(--purple-600)}

    .row{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .checkbox{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:13px}
    .link{font-size:13px;color:var(--purple);text-decoration:none}

    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      gap:8px;padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600;
      background:linear-gradient(90deg,var(--purple),var(--purple-600)); color:white;
      box-shadow: 0 8px 20px rgba(99,102,241,0.18);
    }
    .btn.ghost{background:transparent;color:var(--purple);border:1px solid rgba(99,102,241,0.12);box-shadow:none}
    .btn.google{background:white;color:#111;border:1px solid #e6e9ef;box-shadow: 0 6px 18px rgba(15,23,42,0.06)}
    .small{font-size:13px;padding:8px 10px;border-radius:8px}

    .separator{display:flex;align-items:center;gap:12px;margin:6px 0 12px}
    .separator .line{height:1px;background:#eef2ff;flex:1;border-radius:2px}
    .separator span{font-size:13px;color:var(--muted)}

    .meta{font-size:13px;color:var(--muted);margin-top:8px}
    .footer{font-size:13px;color:var(--muted);margin-top:12px;text-align:center}

    .msg{padding:10px;border-radius:8px;font-size:13px}
    .msg.error{background:rgba(239,68,68,0.08);color:var(--danger);border:1px solid rgba(239,68,68,0.12)}
    .msg.ok{background:rgba(16,185,129,0.06);color:var(--success);border:1px solid rgba(16,185,129,0.12)}

    /* Logged-in view */
    .profile{
      display:flex;gap:12px;align-items:center;
    }
    .avatar{
      width:56px;height:56px;border-radius:12px;background:#eef2ff;display:grid;place-items:center;color:var(--purple);font-weight:700;
    }

    /* Responsive */
    @media (max-width:880px){
      .wrap{grid-template-columns: 1fr; padding:0 12px}
      .hero{order:2}
      .card{order:1;margin-bottom:18px}
    }
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <section class="hero" aria-label="présentation">
      <div class="brand">
        <div class="logo">K</div>
        <div>
          <div style="font-weight:700;font-size:16px;color:#0f172a">Kyky</div>
          <div style="font-size:13px;color:var(--muted)">Crée. Partage. Inspire.</div>
        </div>
      </div>

      <h1>Rejoint la communauté</h1>
      <p class="lead">Tu vas voir c tro bi1</p>

      <div style="margin-top:18px;">
        <strong style="display:block;color:#111827">Fonctions :</strong>
        <ul style="margin-top:8px;color:var(--muted);line-height:1.6">
          <li>ATC webeye</li>
          <li>+</li>
          <li>+</li>
        </ul>
      </div>
    </section>

    <section class="card" aria-label="connexion">
      <div id="ui">
        <div>
          <div class="form-title">Connexion</div>
          <div class="form-sub">Connecte-toi ou crée un compte</div>
        </div>

        <div id="messages" style="margin-bottom:10px"></div>

        <form id="authForm" autocomplete="on">
          <div>
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="ex: toi@mail.com" required />
          </div>

          <div>
            <label for="password">Mot de passe</label>
            <input type="password" id="password" placeholder="••••••••" minlength="6" required />
          </div>

          <div class="row">
            <label class="checkbox"><input type="checkbox" id="remember"> <span>Se souvenir</span></label>
            <a href="#" id="resetLink" class="link">Mot de passe oublié ?</a>
          </div>

          <div style="display:flex;gap:10px;margin-top:6px">
            <button type="submit" id="loginBtn" class="btn">Se connecter</button>
            <button type="button" id="signupBtn" class="btn ghost small">Créer un compte</button>
          </div>

          <div class="separator" aria-hidden>
            <div class="line"></div><span>ou</span><div class="line"></div>
          </div>

          <div style="display:flex;gap:10px">
            <button type="button" id="googleBtn" class="btn google" aria-label="Se connecter avec Google">
              <svg width="18" height="18" viewBox="0 0 24 24" style="vertical-align:middle"><path fill="#EA4335" d="M21.35 11.1h-9.2v2.9h5.4c-.24 1.4-1.2 2.6-2.56 3.3v2.74h4.14c2.43-2.24 3.84-5.54 3.84-9.44 0-.64-.06-1.27-.16-1.89z"/><path fill="#34A853" d="M12.15 22c2.74 0 5.04-.9 6.72-2.44l-4.14-2.74c-1.16.78-2.64 1.24-4.58 1.24-3.52 0-6.5-2.38-7.56-5.58H.86v2.8C2.6 19.72 7 22 12.15 22z"/><path fill="#4A90E2" d="M4.59 13.28A7.17 7.17 0 014 12c0-.44.04-.88.12-1.28V8.04H.86A11.96 11.96 0 000 12c0 1.94.46 3.78 1.28 5.44l3.31-4.16z"/><path fill="#FBBC05" d="M12.15 6.76c1.48 0 2.82.52 3.87 1.54l2.9-2.9C17.2 3.98 14.9 3 12.15 3 7.99 3 3.59 5.28 1.28 8.96l3.31 2.48C5.64 8.98 8.63 6.76 12.15 6.76z"/></svg>
              <span style="margin-left:8px">Google</span>
            </button>
          </div>

          <div class="meta">En te connectant, tu acceptes nos <a class="link" href="#" target="_blank">conditions</a>.</div>
        </form>

        <!-- logged-in area -->
        <div id="loggedArea" style="display:none;margin-top:12px">
          <div class="profile">
            <div class="avatar" id="avatar">U</div>
            <div>
              <div id="displayName" style="font-weight:700;color:#0f172a"></div>
              <div id="displayEmail" style="color:var(--muted);font-size:13px"></div>
            </div>
          </div>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button id="goApp" class="btn ghost small">Ouvrir Kyky</button>
            <button id="signOutBtn" class="btn small">Se déconnecter</button>
          </div>
        </div>

      </div>

      <div class="footer">Besoin d'aide ? <a class="link" href="#">Contact</a></div>
    </section>
  </main>

  <script type="module">
    // --- FIREBASE SETUP (modular SDK v9) ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut,
      onAuthStateChanged,
      sendPasswordResetEmail,
      GoogleAuthProvider,
      signInWithPopup
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

    // --- REPLACE with your Firebase config ---
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAamXzsUBdA4KWdbpfEk1JtP1L5ENLh1Pc",
  authDomain: "plen-95d55.firebaseapp.com",
  databaseURL: "https://plen-95d55-default-rtdb.firebaseio.com",
  projectId: "plen-95d55",
  storageBucket: "plen-95d55.firebasestorage.app",
  messagingSenderId: "147249259769",
  appId: "1:147249259769:web:ee8e5952a96f244f776e28",
  measurementId: "G-ZDLRGQR5NC"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const googleProvider = new GoogleAuthProvider();

    // --- UI elements ---
    const authForm = document.getElementById('authForm');
    const emailEl = document.getElementById('email');
    const passEl = document.getElementById('password');
    const messages = document.getElementById('messages');
    const loginBtn = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');
    const googleBtn = document.getElementById('googleBtn');
    const resetLink = document.getElementById('resetLink');
    const rememberChk = document.getElementById('remember');

    const loggedArea = document.getElementById('loggedArea');
    const displayNameEl = document.getElementById('displayName');
    const displayEmailEl = document.getElementById('displayEmail');
    const avatarEl = document.getElementById('avatar');
    const signOutBtn = document.getElementById('signOutBtn');
    const goAppBtn = document.getElementById('goApp');

    // helper: show message
    function showMessage(text, type='error'){
      messages.innerHTML = '';
      const div = document.createElement('div');
      div.className = 'msg ' + (type==='ok' ? 'ok' : 'error');
      div.textContent = text;
      messages.appendChild(div);
      if(type === 'ok'){
        setTimeout(()=>{ messages.innerHTML = '' }, 4000);
      }
    }

    // simple validation
    function isValidEmail(email){
      return /\S+@\S+\.\S+/.test(email);
    }

    // LOGIN
    authForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = emailEl.value.trim();
      const password = passEl.value;
      if(!isValidEmail(email)){ showMessage('Email invalide'); return; }
      if(password.length < 6){ showMessage('Le mot de passe doit contenir au moins 6 caractères'); return; }
      loginBtn.disabled = true;
      loginBtn.textContent = 'Connexion...';
      try{
        const cred = await signInWithEmailAndPassword(auth, email, password);
        if(rememberChk.checked) localStorage.setItem('kyky_remember', '1'); else localStorage.removeItem('kyky_remember');
        showMessage('Connecté ✓', 'ok');
        // onAuthStateChanged will handle UI
      }catch(err){
        console.error(err);
        showMessage(err.message || 'Erreur lors de la connexion');
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = 'Se connecter';
      }
    });

    // SIGNUP
    signupBtn.addEventListener('click', async ()=>{
      const email = emailEl.value.trim();
      const password = passEl.value;
      if(!isValidEmail(email)){ showMessage('Email invalide'); return; }
      if(password.length < 6){ showMessage('Le mot de passe doit contenir au moins 6 caractères'); return; }
      signupBtn.disabled = true;
      signupBtn.textContent = 'Enregistrement...';
      try{
        await createUserWithEmailAndPassword(auth, email, password);
        showMessage('Compte créé — vous êtes connecté', 'ok');
      }catch(err){
        console.error(err);
        showMessage(err.message || 'Erreur création compte');
      } finally {
        signupBtn.disabled = false;
        signupBtn.textContent = 'Créer un compte';
      }
    });

    // GOOGLE
    googleBtn.addEventListener('click', async ()=>{
      googleBtn.disabled = true;
      googleBtn.textContent = 'Ouverture...';
      try{
        await signInWithPopup(auth, googleProvider);
        showMessage('Connecté avec Google', 'ok');
      }catch(err){
        console.error(err);
        showMessage(err.message || 'Erreur Google Sign-in');
      } finally {
        googleBtn.disabled = false;
        googleBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" style="vertical-align:middle"><path fill="#EA4335" d="M21.35 11.1h-9.2v2.9h5.4c-.24 1.4-1.2 2.6-2.56 3.3v2.74h4.14c2.43-2.24 3.84-5.54 3.84-9.44 0-.64-.06-1.27-.16-1.89z"/><path fill="#34A853" d="M12.15 22c2.74 0 5.04-.9 6.72-2.44l-4.14-2.74c-1.16.78-2.64 1.24-4.58 1.24-3.52 0-6.5-2.38-7.56-5.58H.86v2.8C2.6 19.72 7 22 12.15 22z"/><path fill="#4A90E2" d="M4.59 13.28A7.17 7.17 0 014 12c0-.44.04-.88.12-1.28V8.04H.86A11.96 11.96 0 000 12c0 1.94.46 3.78 1.28 5.44l3.31-4.16z"/><path fill="#FBBC05" d="M12.15 6.76c1.48 0 2.82.52 3.87 1.54l2.9-2.9C17.2 3.98 14.9 3 12.15 3 7.99 3 3.59 5.28 1.28 8.96l3.31 2.48C5.64 8.98 8.63 6.76 12.15 6.76z"/></svg><span style="margin-left:8px">Google</span>';
      }
    });

    // RESET
    resetLink.addEventListener('click', async (e)=>{
      e.preventDefault();
      const email = emailEl.value.trim();
      if(!isValidEmail(email)){ showMessage('Entre ton email puis clique sur "Mot de passe oublié"'); return; }
      try{
        await sendPasswordResetEmail(auth, email);
        showMessage('Email de réinitialisation envoyé ✓', 'ok');
      }catch(err){
        console.error(err);
        showMessage(err.message || 'Impossible d’envoyer l’email de réinitialisation');
      }
    });

    // SIGN OUT
    signOutBtn.addEventListener('click', async ()=>{
      try{
        await signOut(auth);
        showMessage('Déconnecté', 'ok');
      }catch(err){
        console.error(err);
        showMessage('Erreur lors de la déconnexion');
      }
    });

    // OPEN APP (after login)
    goAppBtn.addEventListener('click', ()=> {
      // exemple : ouvrir /app or another page
      window.location.href = './app.html'; // adapter selon ton app
    });

    // AUTH STATE
    onAuthStateChanged(auth, user=>{
      if(user){
        // logged in
        document.getElementById('ui').querySelector('form').style.display = 'none';
        loggedArea.style.display = 'block';
        displayNameEl.textContent = user.displayName || 'Utilisateur';
        displayEmailEl.textContent = user.email || '';
        avatarEl.textContent = (user.displayName ? user.displayName[0].toUpperCase() : (user.email ? user.email[0].toUpperCase() : 'U'));
      }else{
        // logged out
        document.getElementById('ui').querySelector('form').style.display = 'block';
        loggedArea.style.display = 'none';
      }
    });

    // Auto-fill remember (if desired)
    if(localStorage.getItem('kyky_remember')) {
      rememberChk.checked = true;
    }

    // Optional: register service worker if present (PWA)
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('service-worker.js').then(()=> {
        console.log('Service worker enregistré (si présent).');
      }).catch(()=>{/* noop */});
    }
  </script>
</body>
</html>
